(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/Home/index"],{"29e0":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(n("a34a")),i=n("a608");function r(t){return t&&t.__esModule?t:{default:t}}function a(t){return c(t)||u(t)||v(t)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function c(t){if(Array.isArray(t))return b(t)}function l(t,e,n,o,i,r,a){try{var s=t[r](a),u=s.value}catch(c){return void n(c)}s.done?e(u):Promise.resolve(u).then(o,i)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var r=t.apply(e,n);function a(t){l(r,o,i,a,s,"next",t)}function s(t){l(r,o,i,a,s,"throw",t)}a(void 0)}))}}function f(t,e){return m(t)||p(t,e)||v(t,e)||h()}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],o=!0,i=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done);o=!0)if(n.push(a.value),e&&n.length===e)break}catch(u){i=!0,r=u}finally{try{o||null==s["return"]||s["return"]()}finally{if(i)throw r}}return n}}function m(t){if(Array.isArray(t))return t}function g(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=v(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function v(t,e){if(t){if("string"===typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var w=function(){Promise.all([n.e("common/vendor"),n.e("component/GoodsCard")]).then(function(){return resolve(n("d3b9"))}.bind(null,n)).catch(n.oe)},y=function(){Promise.all([n.e("common/vendor"),n.e("component/Z-empty")]).then(function(){return resolve(n("1839"))}.bind(null,n)).catch(n.oe)},S={components:{GoodsCard:w,ZEmpty:y},data:function(){return{isSticky:!1,isShow:!1,scorllLeft:"0%",ad:[],list:[],currentTab:0,navigation:[],notice:[],productList:[],tabList:[],params:{id:0,is_best:1,m_id:""},pages:[],current:0,swiperCurrent:0,loadSkeleton:!0,flag:!0,timer:null}},onLoad:function(e){if(e.scene){var n=decodeURIComponent(e.scene),o=this.searchObj(n);t.setStorageSync("parent_code",o.code),2==o.type&&t.navigateTo({url:"/pages/Goods/details?id="+o.goods_id})}t.showLoading({title:"数据加载中..."}),this.init(),e.parent_code&&t.setStorageSync("parent_code",e.parent_code)},onShow:function(){var e=this;t.$on("updata",(function(){e.collChange()}))},onPullDownRefresh:function(){this.getBaseData(),this.getHomeGoods(!0),t.stopPullDownRefresh(),this.$refs.uTips.show({title:"数据重新加载成功",type:"success",duration:"1500"})},onShareAppMessage:function(){var e=t.getStorageSync("code");return{title:"比邻街",path:"/pages/Home/index?parent_code="+e,success:function(t){console.log("分享成功"+t)},fail:function(t){console.log(t+"失败")}}},methods:{init:function(){this.getBaseData(),this.getHomeCate()},searchObj:function(t){var e,n=t.split("&"),o={},i=g(n);try{for(i.s();!(e=i.n()).done;){var r=e.value,a=r.split("="),s=f(a,2),u=s[0],c=s[1];void 0==o[u]?o[u]=c:o[u]=[].concat(c,o[u])}}catch(l){i.e(l)}finally{i.f()}return o},jumpSearch:function(){t.navigateTo({url:"/pages/Home/search"})},getBaseData:function(e){var n=this;return d(o.default.mark((function e(){var r,a;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r=t.getStorageSync("m_id"),e.next=4,(0,i.HomeBase)(r);case 4:a=e.sent,n.list=a.adverts,n.navigation=a.navigation,n.notice=a.notice,0===n.ad.length&&a.position.length>0&&(n.ad=a.position,n.isShow=!0),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),t.showToast({title:"数据加载失败",icon:"none"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()},swiperNav:function(t){var e=this.list[t].target_rule,n=this.list[t].param;this.jumpRules(e,n)},jumpRules:function(e,n){switch(Number(e)){case 1:break;case 2:t.navigateTo({url:"/pages/Home/webview?url="+encodeURIComponent(JSON.stringify(n))});break;case 3:t.navigateTo({url:"/pages/Goods/details?id="+n});break;case 4:t.navigateTo({url:"/pages/Home/classPage?id="+n});break;case 5:var o=t.getStorageSync("m_id");if(""===o||void 0===o)return t.showModal({title:"提示",content:"您当前处于未登陆状态，请登陆后继续",success:function(e){e.confirm&&t.navigateTo({url:"/pages/My/login"})}});t.navigateTo({url:"/pages/My/promote?m_id="+o});break;default:break}},jumpAd:function(e,n){var o=this;switch(Number(e)){case 1:break;case 2:t.navigateTo({url:"/pages/Home/webview?url="+encodeURIComponent(JSON.stringify(n)),success:function(){o.isShow=!1}});break;case 3:t.navigateTo({url:"/pages/Goods/details?id="+n,success:function(){o.isShow=!1}});break;case 4:t.navigateTo({url:"/pages/Home/classPage?id="+n});break;case 5:var i=t.getStorageSync("m_id");if(""===i||void 0===i)return t.showModal({title:"提示",content:"您当前处于未登陆状态，请登陆后继续",success:function(e){e.confirm&&t.navigateTo({url:"/pages/My/login"})}});t.navigateTo({url:"/pages/My/promote?m_id="+i});break;default:break}},getHomeCate:function(e){var n=this;return d(o.default.mark((function r(){var s,u,c,l;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,i.HomeCate)(e);case 3:s=o.sent,u={goods_cate_id:0,name:"全部"},c=[u].concat(a(s.list)),l=[],c.forEach((function(t,e){n.$set(n.productList,e,[]),l.push(1)})),n.tabList=c,n.pages=l,n.getHomeGoods(),o.next=16;break;case 13:o.prev=13,o.t0=o["catch"](0),t.showToast({title:o.t0,icon:"none"});case 16:case"end":return o.stop()}}),r,null,[[0,13]])})))()},getHomeGoods:function(e){var n=this;this.params.m_id=t.getStorageSync("m_id"),(0,i.HomeGoods)(this.params).then((function(o){o.list.length>0&&(n.productList[n.current]=o.list),e&&(n.current=0,n.swiperCurrent=0,n.pages.fill(1),n.$refs.uTabs.setFinishCurrent(0),n.flag=!0),n.loadSkeleton=!1,t.hideLoading()})).catch((function(e){t.showToast({title:e,icon:"none"})}))},TabChange:function(t){var e=this;this.params.is_best=t+1,this.tabList.forEach((function(t,n){e.$set(e.productList,n,[])})),this.loadSkeleton=!0,this.current=0,this.swiperCurrent=0,this.currentTab=t,this.pages.fill(1),this.$refs.uTabs.setFinishCurrent(0),this.cutoverGoods(0)},cutoverGoods:function(e){var n=this;this.timer&&(t.hideLoading(),clearTimeout(this.timer)),t.showLoading({title:"Loading..."}),0===this.productList[e].length?this.timer=setTimeout((function(){(0,i.HomeGoods)({m_id:n.params.m_id,id:n.params.id,is_best:n.params.is_best,p:n.pages[e]}).then((function(o){if(o.list.length>0){var i=[].concat(a(n.productList[e]),a(o.list));n.$set(n.productList,e,i),n.flag=!0}n.loadSkeleton=!1,t.hideLoading()})).catch((function(e){n.loadSkeleton=!1,t.showToast({title:e,icon:"none"})}))}),500):t.hideLoading()},scrollChange:function(t){var e=t.detail.scrollLeft,n=t.detail.scrollWidth-345,o=e/n*100;this.scorllLeft=.4*o+"%"},tabsChange:function(t){this.swiperCurrent=t},swiperChange:function(t){var e=t.detail.current;this.params.id=this.tabList[e].goods_cate_id,this.cutoverGoods(e)},transition:function(t){var e=t.detail.dx;this.$refs.uTabs.setDx(e)},animationfinish:function(t){var e=t.detail.current;this.$refs.uTabs.setFinishCurrent(e),this.swiperCurrent=e,this.current=e},onreachBottom:function(){this.flag?this.pullUpLoad():t.showToast({title:"没有更多商品了~",icon:"none"})},pullUpLoad:function(){var e=this;return d(o.default.mark((function n(){var r,s;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,e.pages[e.current]+=1,n.next=4,(0,i.HomeGoods)({m_id:e.params.m_id,id:e.params.id,is_best:e.params.is_best,p:e.pages[e.current]});case 4:r=n.sent,0===r.list.length?(e.pages[e.current]-=1,e.flag=!1,t.showToast({title:"没有更多商品了~",icon:"none"})):(s=[].concat(a(e.productList[e.current]),a(r.list)),e.$set(e.productList,e.current,s)),n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),t.showToast({title:n.t0,icon:"none"});case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},collChange:function(e){var n=this;(0,i.HomeGoods)({m_id:this.params.m_id,id:this.params.id,is_best:this.params.is_best,p:this.pages[this.current]}).then((function(e){e.list.length>0&&(n.$set(n.productList,n.current,e.list),n.flag=!0),t.showToast({title:"操作成功"})})).catch((function(e){t.showToast({title:e,icon:"none"})}))}}};e.default=S}).call(this,n("543d")["default"])},"770b":function(t,e,n){},d543:function(t,e,n){"use strict";n.r(e);var o=n("f25c"),i=n("d74c");for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);n("e617");var a,s=n("f0c5"),u=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);e["default"]=u.exports},d74c:function(t,e,n){"use strict";n.r(e);var o=n("29e0"),i=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=i.a},e617:function(t,e,n){"use strict";var o=n("770b"),i=n.n(o);i.a},f25c:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}));var o={uSticky:function(){return n.e("uview-ui/components/u-sticky/u-sticky").then(n.bind(null,"7a33"))},uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"6679"))},uSwiper:function(){return n.e("uview-ui/components/u-swiper/u-swiper").then(n.bind(null,"5e5c"))},uTabsSwiper:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-tabs-swiper/u-tabs-swiper")]).then(n.bind(null,"1be6"))},uMask:function(){return n.e("uview-ui/components/u-mask/u-mask").then(n.bind(null,"e99f"))},uImage:function(){return n.e("uview-ui/components/u-image/u-image").then(n.bind(null,"725b"))},uLoading:function(){return n.e("uview-ui/components/u-loading/u-loading").then(n.bind(null,"2c5b"))},uSkeleton:function(){return n.e("uview-ui/components/u-skeleton/u-skeleton").then(n.bind(null,"1822"))},uTopTips:function(){return n.e("uview-ui/components/u-top-tips/u-top-tips").then(n.bind(null,"99a5"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.__map(t.notice,(function(e,n){var o=t.__get_orig(e),i=t._f("timeFrom")(e.add_time);return{$orig:o,f0:i}})));t._isMounted||(t.e0=function(e){t.isSticky=!0},t.e1=function(e){t.isSticky=!1},t.e2=function(e){t.isShow=!1}),t.$mp.data=Object.assign({},{$root:{l0:n}})},r=[]},f585:function(t,e,n){"use strict";(function(t){n("8ef2");o(n("66fd"));var e=o(n("d543"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["f585","common/runtime","common/vendor"]]]);